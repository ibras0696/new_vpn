–û—Ç–ª–∏—á–Ω–æ üí™
–í–æ—Ç –≥–æ—Ç–æ–≤–∞—è, –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç–≤–æ–µ–≥–æ README ‚Äî **v1.1 (Server-Ready Edition)**
–Ø –≤–Ω—ë—Å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø—Ä–∞–≤–∫–∏: –Ω–∏–∫–∞–∫–æ–π –≤–æ–¥—ã, –≤—Å—ë —á–∏—Å—Ç–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π Linux-—Å–µ—Ä–≤–µ—Ä.
üëá –ú–æ–∂–µ—à—å –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å–≤–æ–π `README.md` —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –≤ `main`.

---

# new_vpn ‚Äî Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VLESS-–∫–ª—é—á–∞–º–∏

–ë–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤—ã–¥–∞–≤–∞—Ç—å, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –æ—Ç–∑—ã–≤–∞—Ç—å VLESS-–∫–ª—é—á–∏ –¥–ª—è XRay.
–ö–ª—é—á–∏ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ Telegram –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º —Å QR-–∫–æ–¥–æ–º, –∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ XRay —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ API.

---

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –ò–Ω–ª–∞–π–Ω-–º–µ–Ω—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π —Å –ø—Ä–µ—Å–µ—Ç–∞–º–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Å—Ä–æ–∫–æ–º.
* –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/—É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ XRay API.
* –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π.
* –°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ubuntu –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ systemd-—é–Ω–∏—Ç–∞ XRay.
* Makefile —Å —Ç–∏–ø–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–µ–ø–ª–æ—è.

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
handlers/          # Telegram-—Ö–µ–Ω–¥–ª–µ—Ä—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ FSM
services/          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å XRay, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∫–ª–∏–µ–Ω—Ç—ã
data/              # async SQLAlchemy: –º–æ–¥–µ–ª–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Å–ª–æ–π –ë–î
filters/           # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã aiogram (–∞–¥–º–∏–Ω –∏ —Ç.–ø.)
scripts/           # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ XRay
tests/             # PyTest (XRay API –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
Dockerfile         # –û–±—Ä–∞–∑ –±–æ—Ç–∞ —Å XRay CLI
docker-compose.yml # –°–µ—Ä–≤–∏—Å "bot" (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ—Ä—ë—Ç –∏–∑ .env)
Makefile           # –ß–∞—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã: —É—Å—Ç–∞–Ω–æ–≤–∫–∞, –∑–∞–ø—É—Å–∫, Docker, —Ç–µ—Å—Ç—ã
pyproject.toml     # PEP 621 + Setuptools
```

---

## üßæ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Ubuntu 22.04 / 24.04 —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ Telegram, Docker Hub –∏ GitHub.
* Python ‚â• 3.11, Git, Make, Docker + Docker Compose.
* –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞, ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
* XRay Core —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ (–±–æ—Ç —É–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ API).

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

```bash
git clone https://github.com/ibras0696/new_vpn.git
cd new_vpn
python3 -m venv .venv && source .venv/bin/activate
make dev-install
cp .env.example .env
```

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:

```
BOT_TOKEN=<—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω>
ADMIN_ID=<—Ç–≤–æ–π_id>
XRAY_API_ENABLED=false
```

–ó–∞–ø—É—Å–∫:

```bash
make run
```

> –ï—Å–ª–∏ XRay API –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏ `XRAY_API_ENABLED=false`, —á—Ç–æ–±—ã –±–æ—Ç –ø—Ä–æ–ø—É—Å–∫–∞–ª –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

---

## üß∞ Makefile: –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                     |
| --------------------------------------- | -------------------------------------------- |
| `make help`                             | –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ü–µ–ª–∏                            |
| `make dev-install`                      | —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å —Ç–µ—Å—Ç–∞–º–∏ –∏ –ª–∏–Ω—Ç–∏–Ω–≥–æ–º |
| `make run`                              | –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫                             |
| `make docker-build`                     | —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞                         |
| `make compose-up` / `make compose-down` | –∑–∞–ø—É—Å–∫ / –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞                   |
| `make docker-logs`                      | –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞                    |
| `make test`                             | –∑–∞–ø—É—Å–∫ PyTest                                |
| `make clean`                            | –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π                                |

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env`

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –ó–Ω–∞—á–µ–Ω–∏–µ                                                  |
| ------------------ | --------------------------------------------------------- |
| `BOT_TOKEN`        | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞                                       |
| `ADMIN_ID`         | Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞                                |
| `DB_ENGINE`        | `sqlite+aiosqlite` –∏–ª–∏ `postgresql+asyncpg`               |
| `DB_NAME`          | –ü—É—Ç—å/–∏–º—è –±–∞–∑—ã                                             |
| `XRAY_DOMAIN`      | –î–æ–º–µ–Ω –∏–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞                                      |
| `XRAY_PORT`        | –ü–æ—Ä—Ç VLESS –≤—Ö–æ–¥–∞                                          |
| `XRAY_SECURITY`    | `tls` –∏–ª–∏ `none`                                          |
| `XRAY_NETWORK`     | `tcp`, `ws`, `grpc`                                       |
| `XRAY_API_ENABLED` | `true` / `false`                                          |
| `XRAY_API_LISTEN`  | –ê–¥—Ä–µ—Å, –≥–¥–µ XRay —Å–ª—É—à–∞–µ—Ç API (`0.0.0.0` –¥–ª—è Linux)         |
| `XRAY_API_HOST`    | –ê–¥—Ä–µ—Å, –∫—É–¥–∞ –±–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (–≤–Ω–µ—à–Ω–∏–π IP –∏–ª–∏ `127.0.0.1`) |
| `XRAY_API_PORT`    | –ü–æ—Ä—Ç API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `10085`)                           |
| `XRAY_INBOUND_TAG` | –¢–µ–≥ inbound-–∞ –≤ XRay                                      |

> ‚ö†Ô∏è –î–ª—è Linux-—Å–µ—Ä–≤–µ—Ä–∞ —É–∫–∞–∂–∏:
> `XRAY_API_LISTEN=0.0.0.0`
> `XRAY_API_HOST=<–≤–Ω–µ—à–Ω–∏–π_IP_–∏–ª–∏_127.0.0.1>`
> –∏ –¥–æ–±–∞–≤—å `network_mode: "host"` –≤ `docker-compose.yml`.

---

## üê≥ Docker-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
make docker-build
docker compose up -d
docker compose logs -f bot
```

### –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è Linux

–î–æ–±–∞–≤—å –≤ `docker-compose.yml` –±–ª–æ–∫:

```yaml
services:
  bot:
    network_mode: "host"
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω–∞–ø—Ä—è–º—É—é –≤–∏–¥–µ—Ç—å XRay API –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–±–µ–∑ `host.docker.internal`).

---

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Ubuntu)

### scripts/setup_ubuntu.py

–ì–æ—Ç–æ–≤–∏—Ç —Å–µ—Ä–≤–µ—Ä: —Å—Ç–∞–≤–∏—Ç Docker, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç UFW, —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```bash
sudo python3 scripts/setup_ubuntu.py --admin vpppn --ports 443 10085
```

### scripts/install_xray_service.py

–°–æ–∑–¥–∞—ë—Ç systemd-—é–Ω–∏—Ç –¥–ª—è XRay:

```bash
sudo python3 scripts/install_xray_service.py --exec /usr/local/bin/xray --config /etc/xray/config.json
```

---

## ‚òëÔ∏è –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏

```bash
ping -c 3 8.8.8.8
curl https://api.telegram.org
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ XRay

```bash
sudo mkdir -p /etc/xray /var/log/xray
sudo curl -L https://github.com/XTLS/Xray-core/releases/download/v25.10.15/Xray-linux-64.zip -o /tmp/xray.zip
sudo apt install -y unzip && sudo unzip /tmp/xray.zip -d /usr/local/share/xray
sudo install -m 755 /usr/local/share/xray/xray /usr/local/bin/xray
sudo python3 scripts/install_xray_service.py --exec /usr/local/bin/xray --config /etc/xray/config.json
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone https://github.com/ibras0696/new_vpn.git
cd new_vpn
cp .env.example .env
nano .env
```

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:

```
BOT_TOKEN=<—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω>
ADMIN_ID=<—Ç–≤–æ–π_id>
XRAY_DOMAIN=141.98.235.192
XRAY_API_ENABLED=true
XRAY_API_LISTEN=0.0.0.0
XRAY_API_HOST=141.98.235.192
XRAY_API_PORT=10085
```

---

### 4. –ó–∞–ø—É—Å–∫

```bash
docker compose up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
sudo mkdir -p /etc/xray
sudo cp ./etc/xray/config.json /etc/xray/config.json
sudo systemctl restart xray
sudo ss -ltnp | grep 10085
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `*:10085 (LISTEN)`

---

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose exec bot sh -c "apt update -qq && apt install -y netcat-openbsd && nc -vz 141.98.235.192 10085"
```

–û–∂–∏–¥–∞–µ–º:

```
Connection to 141.98.235.192 10085 port [tcp/*] succeeded!
```

---

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

* –û—Ç–∫—Ä–æ–π Telegram ‚Üí `/start`
* –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è QR –∏ —Å—Å—ã–ª–∫–∞ –±–µ–∑ –æ—à–∏–±–æ–∫ `failed to dial`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
make test
```

## ü©∫ –û—Ç–ª–∞–¥–∫–∞

```bash
docker compose logs -f bot
journalctl -u xray -f
```

---

## üßæ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© 2025. Contributions welcome.

---

–•–æ—á–µ—à—å, —è —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞—é diff-–≤–µ—Ä—Å–∏—é (`git patch`), —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–ª –µ—ë —á–µ—Ä–µ–∑ `git apply` –∏ –Ω–µ –ø—Ä–∞–≤–∏–ª –≤—Ä—É—á–Ω—É—é?
